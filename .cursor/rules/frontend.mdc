---
globs: frontend/**.*
alwaysApply: false
---

# Frontend — React + Vite SPA

## Stack

- React 19 + TypeScript + Vite
- Tailwind CSS 4 (via `@tailwindcss/vite`)
- shadcn/ui (New York style) — uses the unified `radix-ui` package for primitives
- TanStack Router for file-based routing and deep linking
- TanStack Query for server state
- @visx for data visualization (heatmap)
- Hey API (`@hey-api/openapi-ts`) for generated API client
- next-themes for dark/light mode
- GitHub Actions + Pages for deployment and hosting

## Project Structure

```
frontend/src/
  main.tsx             # Entry point, router setup
  routeTree.gen.ts     # Auto-generated route tree — do not edit
  routes/
    __root.tsx         # Root layout with providers
    index.tsx          # Redirects / to default ticker
    $ticker.tsx        # Main dashboard route with search params
  components/
    Dashboard.tsx      # Main dashboard component
    controls/          # User input components (ticker, metric, direction selects)
    heatmap/           # Visualization components (visx-based heatmap)
    layout/            # App shell (Header, ThemeProvider, ThemeToggle)
    ui/                # shadcn/ui primitives — do not edit by hand
  hooks/               # Custom React Query hooks (useOptionsData, useTickers)
  lib/
    api/generated/     # Auto-generated API client — do not edit
    queryClient.ts     # Singleton QueryClient config
    utils.ts           # Shared utilities (cn, formatRelativeTime)
  types/index.ts       # App-wide types derived from API types
```

## Key Patterns

### API Client & Data Fetching

The API client is auto-generated from the backend OpenAPI spec. Never edit files in `lib/api/generated/`.

Data fetching hooks follow this pattern (see `hooks/useOptionsData.ts`):

1. Import the generated SDK function and configure the client
2. Write a thin async wrapper that calls the SDK and throws on error
3. Export a `useQuery` hook with a descriptive query key

### Types

App types are derived from the generated API types — see `types/index.ts`. Use `Extract`, indexed access types, and `z.infer<>` instead of manually duplicating type definitions.

### Components

- Feature folders under `components/` (controls, heatmap, layout)
- shadcn/ui components in `components/ui/` — add new ones via the shadcn CLI, don't write by hand
  - Always prefer installing/importing chadcn/ui components over creating custom implementations
- Use `cn()` from `lib/utils` for conditional Tailwind classes
- Props interfaces defined inline above the component

### Styling

- Tailwind utility classes; theme tokens defined as CSS variables in `src/index.css`
- Light/dark mode via CSS variables and `next-themes`
- Custom colors are defined in `src/index.css`
- Use semantic tokens (`bg-background`, `text-foreground`, `text-muted-foreground`, etc.)

## Routing & Deep Linking

TanStack Router provides file-based routing with deep linking support:

- **URL structure**: `/heatstrike/$ticker?direction=calls&metric=volume`
- **Path params**: ticker (e.g., `AAPL`)
- **Search params**: `direction` (calls/puts), `metric` (volume, open_interest, etc.)
- Routes are defined in `src/routes/` — the Vite plugin auto-generates `routeTree.gen.ts`
- Use `useParams()` and `useSearch()` to read URL state, `useNavigate()` to update it

## Guidelines

- No global state store — TanStack Query for server state, URL params for UI state
- Do not cast to `any`. Parse unknown external inputs with Zod.
- Do not use eslint disables unless absolutely necessary
- Use the shadcn MCP tools to get docs and examples when adding UI components
- Fetch latest Hey API guidance from https://heyapi.dev/llms.txt when working with the API client

## After Making Changes

- Run `npm run lint` from `frontend/` **in the terminal** (not the IDE's inline linter — it only shows ESLint errors, not TypeScript type errors). This runs both ESLint and `tsc`.
- If you changed how the frontend calls the API (e.g., new endpoints), run `npm run generate:api` to regenerate the client from the backend's `openapi.json`
- Do not run the dev server
- Do not write or run tests
